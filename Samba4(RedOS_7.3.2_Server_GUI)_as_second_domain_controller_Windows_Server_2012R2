Развертывание вторичного контроллера домена на ОС RedOS 7.3.2 Server GUI с использованием Samba4 в уже созданном домене на Windows Server 2012R2
-----------------------------------------------------------------------------------------------------------------------------------------------------------
Все описанные ниже действия выполнялись под пользователем root
-----------------------------------------------------------------------------------------------------------------------------------------------------------
Всем привет! Для реализации данного проекта мне потребовалось:
1) Создать ВМ с ОС Windows Server 2012R2 и обновить данную ОС до последней версии;
2) Прописать статическую адресацию на ВМ с ОС Windows Server 2012R2 и поменять имя сервера;
3) Установить роль "Active Directory" на ВМ с ОС Windows Server 2012R2;
4) На ВМ с ОС Windows Server 2012R2 повысить роль сервера до уровня контроллера домена;
5) Добавить обратные зоны в DNS-сервере на ВМ ОС Windows Server 2012R2;
6) Создать ВМ с ОС RedOS 7.3.2 Server GUI и обновить данную ОС до последней версии;
7) Установить набор необходимых пакетов на ОС RedOS 7.3.2 Server GUI;
8) Прописать статическую адресацию на ОС RedOS 7.3.2 Server GUI и поменять имя сервера;
9) Выполнить преднастройку конфигурационных файлов на ОС RedOS 7.3.2 Server GUI перед подключением к домену на Windows Server 2012R2$
10) Выполнить подключение ОС RedOS 7.3.2 Server GUI к Windows Server 2012R2 как вторичный контроллер домена 
-----------------------------------------------------------------------------------------------------------------------------------------------------------
Адресация уже настроенной ВМ с ОС Windows Server 2012R2
Hostname: dc2.domenok.ru
IP-address: 10.10.10.222
Mask:255.255.255.0
Gateway: 10.10.10.253
DNS: 127.0.0.1
DNS: 10.10.10.111
------------
Адресация уже настроенной ВМ с ОС RedOS 7.3.2 Server GUI
Hostname: dc1.domenok.ru
IP-address: 10.10.10.111
Mask: 255.255.255.0
Gateway: 10.10.10.253
DNS: 10.10.10.111
DNS: 10.10.10.222
Поисковый домен: domenok.ru
-----------------------------------------------------------------------------------------------------------------------------------------------------------
Предисловие:
------------
КД - контроллер домена
------------
Nano - это консольный текстовый редактор для UNIX и Unix-подобных операционных систем, основанный на библиотеке curses и распространяемый под лицензией 
GNU GPL.
------------
Samba4 - это многофункциональный серверный продукт, предоставляющий как реализацию файлового сервера, сервиса печати, так и сервера идентификации(winbind).
------------
Winbind - это демон («служба» в терминах Windows), работающий на клиентах Samba и действующий как прокси для связи между PAM и NSS, работающими на 
компьютере Linux, с одной стороны, и Active Directory, работающей на контроллере домена, с другой.
------------
NMTUI - это инструмент командной строки, который используется для настройки сети в системах Gnu / Linux. При запуске он вызывает графический текстовый 
интерфейс, который помогает пользователям легко и эффективно настраивать сетевые интерфейсы.
------------
Active Directory (AD) — это службы каталогов корпорации Microsoft для операционных систем семейства Windows Server. С помощью AD можно объединить различные 
объекты сети (серверы, принтеры и различные сервисы) в единую систему, наладить удобный поиск и использование необходимых данных.
------------
Сервер - это компьютер, выполняющий определённые роли в домене.
------------
Контроллер домена - это сервер, хранящий каталог и обслуживающий запросы пользователей к каталогу. Помимо хранения данных контроллер домена может выступать 
в качестве одной из FSMO-ролей.
------------
Домен - это минимальная структурная единица организации Active Directory(может состоять из пользователей, компьютеров, принтеров, прочих общих ресурсов).
------------
Дерево доменов - это иерархическая система доменов, имеющая единый корень(корневой домен).
------------
Лес доменов - это множество деревьев доменов, находящихся в различных формах доверительных отношений.
-----------------------------------------------------------------------------------------------------------------------------------------------------------
1-5) Ни для кого не секрет, как настраивается ВМ с ОС Windows Server 2012R2 и как поднимается контроллер домена. И для того, чтобы не захламлять интсрукцию,
я предпочту не рассказывать о том, как настраивается ВМ с ОС Windows Server 2012R2.
Но вот что нужно знать при создании КД. КД должен быть с таким функционалом:
------------
1 - Forest functional level: Windows Server 2008R2;
2 - Domain functional level: Windows Server 2008R2.
------------
Если создадите с другим функционалом, то работать ничего не будет.
ТАКЖЕ!!! Не забудьте добавить обратные DNS-зоны.
В моём примере обратная DNS-зона будет выглядеть следующим образом: 10.10.10.in-addr.arpa
-----------------------------------------------------------------------------------------------------------------------------------------------------------
Переходим к настройке ВМ с ОС RedOS 7.3.2 Server GUI
-----------------------------------------------------------------------------------------------------------------------------------------------------------
6) Перед началом выполнения каких-либо манипуляций, нужно выполнить подготовку ОС RedOS 7.3.2 Server GUI. Для начала обновим пакеты системы.
-----------------------------------------------------------------------------------------------------------------------------------------------------------
yum update -y && yum upgrade -y |#|#| Поиск и обновление пакетов системы
-----------------------------------------------------------------------------------------------------------------------------------------------------------
reboot |#|#| Команда для перезагрузки ОС
-----------------------------------------------------------------------------------------------------------------------------------------------------------
7) Установка необходимых пакетов/компонентов.
-----------------------------------------------------------------------------------------------------------------------------------------------------------
yum install samba-client*.x86_64 samba-common.noarch samba-common*x86_64 samba-dc*.x86_64 samba-libs*.x86_64 samba-winbind*.x86_64 -y |#|#| Команда для 
установки небходимых пакетов, которые понадобятся для сборки КД на Samba4
-----------------------------------------------------------------------------------------------------------------------------------------------------------
smbd -b | grep HAVE_LIBKADM5SRV_MIT |#|#| Если следующая команда выдаёт "HAVE_LIBKADM5SRV_MIT", тогда нужно установить Samba с  поддержкой Kerberos Heimdal.
-----------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y redadm |#|#| Команда для установки пакета с ПО RedAdm, для управления КД Samba4
-----------------------------------------------------------------------------------------------------------------------------------------------------------
8) Также для избежания потери связи с сервером, нужно позаботиться о статической IP-адресации. Статическую адресацию можно прописать с помощью инструмента
командной строки nmtui.
-----------------------------------------------------------------------------------------------------------------------------------------------------------
yum install -y NetworkManager-tui |#|#| Команда для установки пакета NMTUI, если вдруг его не окажется на сервере
------------
Гайд по тому, как пользоваться инструментом nmtui, вы можете посмотреть в интернете.
-----------------------------------------------------------------------------------------------------------------------------------------------------------
После настройки статической IP-адресации, измените имя сервера. Это можно сделать через NMTUI, либо командой.
------------
hostnamectl set-hostname dc1.domenok.ru
-----------------------------------------------------------------------------------------------------------------------------------------------------------
Следующим шагом укажите адрес первичного КД в файле "hosts", который лежит в каталоге "/etc/"
------------
10.10.10.222 dc2.domenok.ru dc2
-----------------------------------------------------------------------------------------------------------------------------------------------------------
systemctl restart NetworkManager |#|#| Команда для применения настроек на сетевом интерфейсе
-----------------------------------------------------------------------------------------------------------------------------------------------------------
cat /etc/resolv.conf |#|#| Команда для проверки файла "resolv.conf"
------------
В консоли должно отображаться следующее
# Generated by NetworkManager
search domenok.ru
nameserver 10.10.10.222
-----------------------------------------------------------------------------------------------------------------------------------------------------------
9) Подготовка конфигурационных файлов перед присоединением к домену "domenok.ru"
-----------------------------------------------------------------------------------------------------------------------------------------------------------
mv /etc/krb5.conf /etc/krb5.conf.bak |#|#| Команда для переименования используемого по умолчанию конфигурационного файла samba
-----------------------------------------------------------------------------------------------------------------------------------------------------------
mv /etc/samba/smb.conf /etc/samba/smb.conf.bak |#|#| Команда для переименования используемого по умолчанию конфигурационного файла kerberos
-----------------------------------------------------------------------------------------------------------------------------------------------------------
smbd -V |#|#| Команда для проверки установленной версии samba
-----------------------------------------------------------------------------------------------------------------------------------------------------------
nano /etc/selinux/config |#|#| Команда для редактирования конфигурационного файла "config" в каталоге "/etc/selinux/"
------------
Нужно заменить текст SELINUX=enforcing на SELINUX=permissive
------------
setenforce 0 |#|#| Команда для временного отключения selinux
-----------------------------------------------------------------------------------------------------------------------------------------------------------
10) После всех произведенных настроек, можно приступать к подключению сервера, к контроллеру домена "domenok.ru" на ВМ с ОС Windows Server 2012R2
-----------------------------------------------------------------------------------------------------------------------------------------------------------
samba-tool domain join domenok.ru DC -U"domenok\Администратор" |#|#| Команда для подключения ВМ с ОС RedOS 7.3.2 Server GUI, к ВМ с ОС Windows Server 2012R2
как контроллер домена.
-----------------------------------------------------------------------------------------------------------------------------------------------------------

























